#pragma once

#include "vivid.h"
#include <list>
#include "enemy/enemy.h"
#include "enemy/enemy_id.h"
#include "../stage_manager/stage_manager.h"

class ICharacter;

/*
==================================================
 敵マネージャクラス
 ・敵の生成 / 更新 / 描画 / 解放を一括管理
 ・CSVから読み込んだ敵配置テーブルをもとに敵を生成
 ・シングルトンで全体からアクセスされる
==================================================
*/
class CEnemyManager
{
public:
	//==================================================
	// インスタンスの取得（シングルトン）
	//==================================================
	static CEnemyManager& GetInstance(void);

	//==================================================
	// 初期化
	// ・敵リスト、敵テーブルを初期化
	// ・CSVから敵配置データを読み込む
	//==================================================
	void Initialize(void);

	//==================================================
	// 更新
	// ・敵出現テーブルの更新
	// ・既存敵の更新
	//==================================================
	void Update(void);

	//==================================================
	// 描画
	// ・全敵の描画
	//==================================================
	void Draw(void);

	//==================================================
	// 解放
	// ・敵をすべて削除
	//==================================================
	void Finalize(void);

	//==================================================
	// 敵の作成
	// ・ENEMY_ID に応じた敵クラスを生成
	//==================================================
	void Create(ENEMY_ID id, const vivid::Vector2& position);

	//==================================================
	// 地面の上にいる判定
	// ・1体でも地面に接していれば true
	//==================================================
	bool OnGround(IStage* stage);

	//==================================================
	// 攻撃処理
	// ・全敵に対して攻撃処理を実行
	//==================================================
	void Attack(ICharacter* character);

private:
	//==================================================
	// コンストラクタ（外部生成禁止）
	//==================================================
	CEnemyManager(void);

	// コピー禁止
	CEnemyManager(const CEnemyManager& rhs) = delete;

	// デストラクタ
	~CEnemyManager(void) = default;

	// 代入禁止
	CEnemyManager operator=(const CEnemyManager& rhs) = delete;

	//==================================================
	// 敵配置データの読み込み
	// ・CSVから敵IDと出現位置を取得
	//==================================================
	void DeployEnemy(void);

	//==================================================
	// 敵テーブルの更新
	// ・出現待ちの敵を順次生成
	//==================================================
	void UpdateEnemyTable(void);

	//==================================================
	// 敵の更新
	// ・当たり判定
	// ・更新
	// ・非アクティブ敵の削除
	//==================================================
	void UpdateEnemy(void);

	//==================================================
	// 敵テーブルCSVの列番号
	//==================================================
	enum class ENEMY_TABLE_DATA_PARAM
	{
		ID,	// 敵ID
		X,	// X座標
		Y,	// Y座標
	};

	//==================================================
	// 敵テーブル用構造体
	//==================================================
	struct ENEMY_TABLE_DATA
	{
		ENEMY_ID id;	// 敵ID
		int x;			// 出現X座標
		int y;			// 出現Y座標
	};

	//==================================================
	// 型定義
	//==================================================
	using ENEMY_TABLE_LIST = std::list<ENEMY_TABLE_DATA>;	// 敵出現テーブル
	using ENEMY_LIST = std::list<IEnemy*>;					// 現在存在する敵リスト

	//==================================================
	// メンバ変数
	//==================================================
	ENEMY_LIST			m_EnemyList;	// 現在存在している敵
	ENEMY_TABLE_LIST	m_EnemyTable;	// 出現待ちの敵テーブル
};

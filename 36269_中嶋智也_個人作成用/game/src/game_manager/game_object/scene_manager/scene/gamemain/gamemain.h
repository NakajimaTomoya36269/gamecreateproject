#pragma once

#include "../scene.h"
#include "vivid.h"
#include "../../../goal/goal.h"
#include "../../../background/background.h"
#include "gamemain_state.h"

//-----------------------------------------------------------------------------
// ゲーム本編シーン
// ・IScene を継承し、PLAY / PAUSE 状態を内包する
// ・各 Manager を直接所有せず、オーケストレーターとして振る舞う
//-----------------------------------------------------------------------------
class CGamemain : public IScene
{
public:
	//-------------------------------------------------------------------------
	// コンストラクタ
	// ・軽量初期化のみを行う
	// ・重い初期化（生成・ロード）は Initialize() に集約
	//-------------------------------------------------------------------------
	CGamemain(void);

	// デストラクタ
	// ・IScene 経由で管理されるため default で問題なし
	~CGamemain(void) = default;

	//-------------------------------------------------------------------------
	// 初期化
	// ・シーン開始時／リセット時に呼ばれる
	// ・各 Manager とシーン固有オブジェクトのライフサイクル開始点
	//-------------------------------------------------------------------------
	void Initialize(void) override;

	//-------------------------------------------------------------------------
	// 更新
	// ・状態遷移判定 → 状態別更新 の流れを保証
	//-------------------------------------------------------------------------
	void Update(void) override;

	//-------------------------------------------------------------------------
	// 描画
	// ・描画順がレイヤー構造を表す
	//-------------------------------------------------------------------------
	void Draw(void) override;

	//-------------------------------------------------------------------------
	// 解放
	// ・Initialize() と対になる後処理
	// ・Manager / シーン固有オブジェクトの破棄を行う
	//-------------------------------------------------------------------------
	void Finalize(void) override;

private:
	//-------------------------------------------------------------------------
	// PLAY 状態専用の更新処理
	// ・ゲーム進行の中核ロジック
	//-------------------------------------------------------------------------
	void UpdatePlay(void);

	//-------------------------------------------------------------------------
	// PAUSE 状態専用の更新処理
	// ・入力受付・メニュー操作を想定
	//-------------------------------------------------------------------------
	void UpdatePause(void);

	//-------------------------------------------------------------------------
	// 状態遷移管理
	// ・入力による PLAY / PAUSE 切替およびシーン遷移を集約
	//-------------------------------------------------------------------------
	void ChangeState(void);

	//-------------------------------------------------------------------------
	// デバッグ用フォントサイズ
	//-------------------------------------------------------------------------
	static const int	m_font_size;

	//-------------------------------------------------------------------------
	// デバッグ表示用位置
	// ・ゲームロジックとは独立した補助情報
	//-------------------------------------------------------------------------
	vivid::Vector2		m_Position;

	//-------------------------------------------------------------------------
	// シーン固有オブジェクト
	// ・Manager 管理ではなく Gamemain が直接所有
	//-------------------------------------------------------------------------
	CGoal				m_goal;			// ゴール判定用オブジェクト
	CBackGround			m_background;	// 背景スクロール・演出管理

	//-------------------------------------------------------------------------
	// ゲームメイン状態
	// ・PLAY / PAUSE を明示的に分離
	// ・State パターンへ拡張しやすい構造
	//-------------------------------------------------------------------------
	GAMEMAIN_STATE_ID	m_CurrentStateID;
};

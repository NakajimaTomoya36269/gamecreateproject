#pragma once

#include "vivid.h"
#include "bullet/bullet_id.h"
#include <list>

class IBullet;
class IStage;

//------------------------------------------------------------
// 弾管理クラス
// ・弾の生成、更新、描画、破棄を一括管理する
// ・シングルトンとして使用する
//------------------------------------------------------------
class CBulletManager
{
public:
	//--------------------------------------------------------
	// シングルトンインスタンスの取得
	//--------------------------------------------------------
	static CBulletManager& GetInstance(void);

	//--------------------------------------------------------
	// 初期化処理
	//--------------------------------------------------------
	// ・内部リストの初期化
	//--------------------------------------------------------
	void Initialize(void);

	//--------------------------------------------------------
	// 更新処理
	//--------------------------------------------------------
	// ・全弾の Update
	// ・非アクティブ弾の整理
	//--------------------------------------------------------
	void Update(void);

	//--------------------------------------------------------
	// 描画処理
	//--------------------------------------------------------
	// ・全弾の Draw
	//--------------------------------------------------------
	void Draw(void);

	//--------------------------------------------------------
	// 解放処理
	//--------------------------------------------------------
	// ・生成した弾の破棄
	//--------------------------------------------------------
	void Finalize(void);

	//--------------------------------------------------------
	// 弾の生成
	//--------------------------------------------------------
	// id        : 弾の種類ID
	// position  : 発射位置
	// direction : 発射角（ラジアン）
	// speed     : 発射速度
	//--------------------------------------------------------
	void Create(
		BULLET_ID id,
		const vivid::Vector2& position,
		float direction,
		float speed);

	//--------------------------------------------------------
	// ステージとの当たり判定
	//--------------------------------------------------------
	// stage : 判定対象ステージ
	//--------------------------------------------------------
	void CheckHitStage(IStage* stage);

private:
	//--------------------------------------------------------
	// コンストラクタ（外部生成禁止）
	//--------------------------------------------------------
	CBulletManager(void);

	//--------------------------------------------------------
	// コピー禁止
	//--------------------------------------------------------
	CBulletManager(const CBulletManager& rhs) = delete;

	//--------------------------------------------------------
	// デストラクタ
	//--------------------------------------------------------
	~CBulletManager(void) = default;

	//--------------------------------------------------------
	// 代入禁止
	//--------------------------------------------------------
	CBulletManager& operator=(const CBulletManager& rhs) = delete;

	//--------------------------------------------------------
	// 型定義
	//--------------------------------------------------------
	using BULLET_LIST = std::list<IBullet*>;

	//--------------------------------------------------------
	// メンバ変数
	//--------------------------------------------------------
	BULLET_LIST m_BulletList;   // 管理中の弾リスト
};

#pragma once

#include "vivid.h"
#include "bullet_id.h"

class IStage;

//------------------------------------------------------------
// 弾の基底クラス
// ・すべての弾はこのクラスを継承する
// ・移動、スクロール影響、当たり判定の共通処理を管理
//------------------------------------------------------------
class IBullet
{
public:
	//--------------------------------------------------------
	// コンストラクタ
	//--------------------------------------------------------
	// width  : 弾の横幅
	// height : 弾の高さ
	// radius : 円判定用半径
	// id     : 弾の種類ID
	//--------------------------------------------------------
	IBullet(int width, int height, float radius, BULLET_ID id);

	//--------------------------------------------------------
	// デストラクタ
	//--------------------------------------------------------
	virtual ~IBullet(void) = default;

	//--------------------------------------------------------
	// 初期化処理
	//--------------------------------------------------------
	// position  : 初期位置
	// direction : 発射角（ラジアン）
	// speed     : 発射速度
	//--------------------------------------------------------
	virtual void Initialize(
		const vivid::Vector2& position,
		float direction,
		float speed);

	//--------------------------------------------------------
	// 更新処理
	//--------------------------------------------------------
	// ・弾の移動
	// ・スクロール影響
	// ・画面外判定
	//--------------------------------------------------------
	virtual void Update(void);

	//--------------------------------------------------------
	// 描画処理（派生クラスで実装）
	//--------------------------------------------------------
	virtual void Draw(void);

	//--------------------------------------------------------
	// 解放処理（必要に応じて派生クラスで実装）
	//--------------------------------------------------------
	virtual void Finalize(void);

	//--------------------------------------------------------
	// ステージとの当たり判定
	//--------------------------------------------------------
	// stage : 判定対象のステージ
	// 戻り値: 当たっていれば true
	//--------------------------------------------------------
	virtual bool CheckHitStage(IStage* stage);

	//--------------------------------------------------------
	// 座標取得
	//--------------------------------------------------------
	vivid::Vector2 GetPosition(void);

	//--------------------------------------------------------
	// 中心座標取得（円判定用）
	//--------------------------------------------------------
	vivid::Vector2 GetCenterPosition(void);

	//--------------------------------------------------------
	// サイズ・状態取得
	//--------------------------------------------------------
	int   GetWidth(void);
	int   GetHeight(void);
	float GetRadius(void);

	//--------------------------------------------------------
	// アクティブフラグ取得・設定
	//--------------------------------------------------------
	bool GetActiveFlag(void);
	void SetActiveFlag(bool active);

	//--------------------------------------------------------
	// 弾ID取得
	//--------------------------------------------------------
	BULLET_ID GetBulletID(void);

protected:
	//--------------------------------------------------------
	// 有効範囲チェック（画面外判定）
	//--------------------------------------------------------
	void CheckArea(void);

	//--------------------------------------------------------
	// メンバ変数
	//--------------------------------------------------------
	int            m_Width;           // 幅
	int            m_Height;          // 高さ
	float          m_Radius;          // 半径（円判定）
	float          m_Rotation;        // 回転角
	bool           m_ActiveFlag;      // 有効フラグ
	BULLET_ID      m_BulletID;        // 弾の種類ID
	vivid::Vector2 m_Position;        // 位置
	vivid::Vector2 m_Velocity;        // 弾自身の速度
	vivid::Vector2 m_ScrollVelocity;  // スクロール影響速度
	vivid::Rect    m_Rect;            // 描画範囲
	vivid::Vector2 m_Anchor;          // 回転・拡縮の基準点
	vivid::Vector2 m_Scale;           // 拡大率

	//--------------------------------------------------------
	// 定数パラメータ
	//--------------------------------------------------------
	static const float m_scroll_speed; // スクロール速度
	static const float m_friction;     // 減衰率
};

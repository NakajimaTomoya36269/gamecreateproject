#pragma once

#include "vivid.h"
#include "../stage.h"

//====================================================
// 落下床クラス
//====================================================
// ・プレイヤーが乗る／一定条件で落下する床ギミック
// ・画面外へ落下後、一定時間経過で元の位置へ復帰
// ・IStage を継承し、当たり判定・位置管理は基底に委譲
//
// 拡張想定：
// ・プレイヤー接触トリガー
// ・スイッチ連動
// ・落下前の予兆演出（揺れ、点滅）
//====================================================
class CFallFloor
	: public IStage
{
public:
	//================================================
	// コンストラクタ
	//================================================
	// ・ステージサイズと STAGE_ID は cpp 側で基底に設定
	CFallFloor(void);

	// デストラクタ
	~CFallFloor(void) = default;

	//================================================
	// 初期化
	//================================================
	// @param position : ステージ上での初期配置位置
	// ・落下速度、復帰タイマーを初期状態へリセット
	void Initialize(const vivid::Vector2& position) override;

	//================================================
	// 更新
	//================================================
	// ・落下状態判定
	// ・落下移動
	// ・画面外判定
	// ・復帰タイマー制御
	void Update(void) override;

	//================================================
	// 描画
	//================================================
	// ・画面内に存在する場合のみ描画
	// ・画面外でもロジックは継続
	void Draw(void) override;

	//================================================
	// 解放
	//================================================
	// ・現状は基底クラスに処理委譲
	void Finalize(void) override;

private:
	//================================================
	// 定数（クラス共通）
	//================================================

	static const int			m_width;		// 床の横幅（当たり判定含む）
	static const int			m_height;		// 床の高さ
	static const float			m_fall_speed;	// 落下時のY方向速度
	static const float			m_return_time;	// 復帰までの待機時間（フレーム基準）
	static const std::string	m_floor_texture_path;	// 床の絵のファイルパス

	//================================================
	// メンバ変数
	//================================================

	vivid::Vector2				m_FallVelocity;	// 落下用速度ベクトル
	float						m_ReturnTimer;	// 復帰待機用タイマー
	unsigned int				m_Color;		// 描画色（デバッグ・拡張用）
};
